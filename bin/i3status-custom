#!/usr/bin/env bash

i3status-switch | while :
do
    read line
    prefix=''
    if [[ "$line" == ","* ]]; then
        line="${line:1}"
        prefix=','
    fi
    if [[ "$line" == "[{"* ]]; then
        PLAYING="ï†¼ $(spotify-ctrl status)"
        export PLAYING
        out=$(echo "$line" | jq -c '. |= [{ name: "spotify", markup: "none", "color": "#1DB951", "full_text": env.PLAYING }] + .')
        echo "${prefix}${out}"
    else
        echo "${prefix}${line}" || exit 1
    fi
done

